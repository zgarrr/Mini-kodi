<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiniKodi PWA</title>
<link rel="manifest" href="manifest.json">
<style>
  body { margin:0; font-family:sans-serif; background:#111; color:#fff; }
  header { padding:12px; text-align:center; background:#222; font-size:18px; }
  input { width: calc(100% - 24px); margin:12px; padding:8px; font-size:16px; }
  .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); gap:12px; padding:12px; }
  .item { cursor:pointer; }
  .item img { width:100%; height:auto; display:block; border-radius:6px; }
  .item span { display:block; text-align:center; font-size:14px; margin-top:4px; }
</style>
</head>
<body>
<header>MiniKodi PWA</header>
<input type="text" id="search" placeholder="Search movies or series...">
<div class="grid" id="results"></div>

<script>
const results = document.getElementById('results');
const searchInput = document.getElementById('search');

searchInput.addEventListener('keypress', e => {
  if(e.key === 'Enter') {
    searchMovies(searchInput.value);
  }
});

async function searchMovies(query) {
  results.innerHTML = 'Loading...';

  // Fetch only movies/series from Internet Archive
  const url = `https://archive.org/advancedsearch.php?q=(${encodeURIComponent(query)}) AND mediatype:(movies)&fl=identifier,title,creator,year&rows=20&page=1&output=json`;
  try {
    const resp = await fetch(url);
    const data = await resp.json();
    const docs = data.response.docs;
    results.innerHTML = '';

    if(docs.length === 0) {
      results.innerHTML = '<p style="text-align:center;">No results found ðŸ‘€</p>';
      return;
    }

    docs.forEach(d => {
      const titleLower = (d.title || '').toLowerCase();
      if(titleLower.includes('trailer') || titleLower.includes('clip') || titleLower.includes('teaser')) return;

      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<img src="https://archive.org/services/get-item-image.php?identifier=${d.identifier}&mediatype=movies&backup=1"><span>${d.title || d.identifier}</span>`;
      div.onclick = () => playMovie(d.identifier);
      results.appendChild(div);
    });

  } catch(err) {
    results.innerHTML = '<p style="text-align:center;">Error fetching results ðŸ˜…</p>';
    console.error(err);
  }
}

function playMovie(id) {
  window.open(`https://archive.org/details/${id}`, '_blank');
}
</script>
</body>
</html>
